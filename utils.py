import json
import re


def load_data(
    input_file: str,
):
    if input_file.endswith('.json'):
        with open(input_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
    elif input_file.endswith('.jsonl'):
        with open(input_file, 'r', encoding='utf-8') as f:
            data = [json.loads(line) for line in f]
    else:
        raise ValueError(f'input_file must be json or jsonl, but got {input_file}')
    return data


def extract_score(text):
    pattern = r"\d+"
    matches = list(re.finditer(pattern, text))
    # print(matches)
    if matches:
        last_match = matches[-1]
        try:
            score = int(last_match.group())
            return score if 0 <= score <= 10 else -1
        except:
            return -1
    return -1

def bad_word_processor(token_ids, logits):
    # special tokens (like <im_start>)
    logits[151644] = float("-inf")
    logits[151646:] =  float("-inf")

    # emoji
    for i in [148391, 149951, 149945, 146865, 149934, 147722, 149661, 147439, 147569, 145373, 147438, 148272, 145877, 151381, 146830, 145023, 149217, 145691, 149957, 147434, 145663, 147924, 147120, 145905, 147519, 147527, 146924, 150675, 144523, 147147, 146467, 144444, 144713, 148726, 145443, 148720, 146296, 148401, 144858, 145166, 147139, 146042, 145815, 146386, 145863, 144519, 149944, 149915, 149184, 146709, 146181, 146454, 146223, 145557, 145737, 147239, 149679, 148823, 149320, 145492, 145779, 148389, 147195, 147770, 147122, 148721, 146658, 144251, 147004, 147614, 149930, 149176, 145759, 147922, 145480, 146300, 146983, 146971, 151428, 148764, 151387, 146660, 144693, 146524, 147600, 144247, 147040, 145734, 149181, 148408, 145705, 148765, 146364, 144834, 146222, 146518, 147726, 148738, 147775, 149918, 147351, 149205, 148819, 148740, 145814, 151415, 148724, 145794, 147064, 146299, 145342, 144880, 144346, 150117, 146605, 149931, 145379, 151408, 148104, 149995, 147737, 150041, 145337, 149204, 145654, 147617, 147571, 145926, 147073, 147149, 146909, 145536, 147863, 147260, 149937, 149189, 147358, 145824, 148897, 144363, 147511, 147316, 147788, 146895, 149933, 151597, 148399, 148396, 151452, 145375, 149300, 148731, 146571, 147193, 146621, 147691, 145469, 145568, 151394, 145867, 148109, 146015, 147839, 148387, 148006, 145314, 145560, 149359, 146166, 145559, 145647, 151397, 148403, 145609, 147319, 145921, 147436, 146348, 146104, 151406, 148168, 148715, 147146, 147464, 145968, 146754, 151401, 148111, 148409, 148733, 147921, 146692, 149188, 149943, 145252, 145358, 146864, 147841, 147927, 146331, 146419, 147586, 149993, 145821, 147168, 145806, 146249, 146200, 145633, 147665, 149914, 147156, 145707, 149210, 146980, 147923, 147948, 145121, 149183, 147310, 145967, 146002, 146335, 145712, 147432, 147084, 147236, 151409, 145261, 146615, 146390, 145494, 148469, 146959, 149302, 147729, 148116, 148112, 145271, 146102, 145849, 147028, 146133, 147318, 148556, 147483, 145392, 146024, 145391, 145653, 147069, 145764, 145419, 146819, 148113, 146867, 149922, 149919, 145012, 147381, 147473, 145748, 145080, 146019, 146157, 146764, 146023, 147173, 145549, 147283, 147490, 146561, 146586, 145573, 145027, 150676, 146269, 150009, 147257, 149186, 147570, 147578, 147734, 146081, 146117, 148461, 146329, 149920, 145002, 148786, 147797, 146680, 151385, 148115, 146421, 151453, 147526, 147598, 147119, 148318, 148732, 145078, 144927, 148181, 147363, 147587, 146016, 144126, 145679, 148236, 147631, 145234, 147773, 147099, 145232, 146018, 146483, 147405, 149361, 148235, 145460, 148442, 147774, 149216, 145041, 146202, 147740, 148384, 148238, 148723, 149360, 149187, 145971, 144185, 146751, 148392, 146089, 148703, 146110, 148619, 144534, 150156, 148394, 146260, 146755, 147724, 146177, 146184, 146224, 149219, 147949, 144646, 147864, 146960, 146929, 146818, 146251, 145731, 147723, 145601, 148452, 144610, 147664, 147736, 145932, 147629, 151478, 149916, 151454, 147138, 144212, 146958, 147730, 146585, 145721, 145933, 145072, 146906, 148388, 147802, 147739, 149927, 149201, 147010, 147267, 145711, 146029, 146620, 147772, 145538, 146437, 145714, 145402, 146162, 149942, 146383, 145595, 147237, 147481, 148036, 145517, 146381, 148063, 141334, 149180, 145665, 147567, 147176, 145481, 145290, 144656, 144986, 149332, 146044, 146178, 148405, 146330, 146853, 146480, 147919, 146957, 147978, 147977, 148736, 146750, 145527, 146705, 146061, 147328, 148164, 146519, 151404, 146995, 146284, 145850, 148195, 146308, 145306, 147520, 149932, 145561, 148400, 147151, 144670, 147644, 147579, 147962, 147435, 144784, 145258, 149912, 145504, 146221, 148390, 146146, 150175, 151405, 147074, 146530, 147231, 149929, 147769, 146866, 144501, 146161, 146987, 146694, 144963, 146014, 147577, 149195, 144995, 145345, 148203, 147352, 146991, 149938, 149451, 145459, 148541, 148105, 145836, 149193, 144349, 148514, 148704, 145534, 148713, 146824, 146842, 145845, 151383, 146544, 148893, 144232, 145847, 148725, 145055, 144844, 145320, 147833, 144658, 147433, 146565, 148717, 150714, 145866, 145670, 146956, 146584, 146827, 151382, 151396, 148237, 145537, 147235, 146657, 148103, 149953, 149921, 145378, 145114, 149202, 150294, 146412, 149198, 147980, 148107, 11909, 147314, 145523, 145367, 145286, 144917, 147026, 145756, 145973, 145639, 145732, 148705, 147437, 146570, 149994, 148322, 145410, 146766, 147210, 149683, 148101, 146091, 147121, 146426, 149196, 147627, 146566, 151386, 147393, 145202, 145177, 20043, 149218, 146763, 149200, 148190, 144832, 145710, 145269, 146297, 145401, 146735, 148454, 146562, 149997, 146402, 147934, 149190, 145328, 148816, 147313, 146734, 146043, 148270, 147465, 147963, 149182, 149959, 148171, 149213, 144841, 149949, 149940, 144914, 148037, 145207, 147140, 149935, 149924, 151384, 151403, 145356, 145851, 146420, 146653, 149203, 147259, 146918, 146676, 147918, 145298, 148269, 145927, 147800, 149917, 151400, 146869, 147928, 136879, 145245, 145491, 146283, 147727, 145948, 147126, 148385, 144881, 147728, 149209, 147491, 147148, 148062, 147929, 147920, 148727, 146468, 147651, 145843, 148061, 147360, 145574, 145844, 146521, 145865, 145848, 146900, 144837, 147916, 149322, 145467, 146704, 147580, 149179, 148709, 144966, 146163, 148711, 149057, 146443, 147071, 144811, 146691, 145669, 147497, 147336, 148802, 146752, 148240, 146004, 146008, 146635, 146332, 144907, 151411, 148003, 151393, 149206, 146103, 146298, 146804, 148939, 146278, 145631, 147888, 144979, 146520, 147950, 148712, 16109, 148146, 149680, 148110, 148102, 151412, 148397, 145618, 144817, 146795, 146354, 149056, 147232, 144951, 147211, 148100, 145124, 146450, 144783, 144069, 151413, 147576, 147575, 147194, 145893, 146833, 147933, 146769, 147067, 145389, 147233, 151399, 148729, 144695, 146391, 147573, 144543, 148145, 149199, 146220, 149956, 144994, 146388, 148404, 151509, 144848, 147733, 146583, 149660, 149197, 148728, 145116, 146701, 148719, 146134, 146829, 146796, 145903, 149925, 147622, 147487, 147947, 147312, 147865, 145216, 145377, 144961, 145825, 146158, 147027, 146436, 145597, 76709, 145749, 149950, 147265, 146040, 146304, 145802, 148393, 145969, 146896, 146753, 145950, 146469, 146281, 148429, 147361, 148470, 149952, 145892, 146250, 145795, 147964, 147738, 149301, 151392, 149939, 145368, 146899, 151391, 147721, 147925, 147731, 144668, 147725, 149191, 146652, 147999, 148474, 145064, 146295, 147317, 147824, 146659, 146003, 150136, 151367, 145784, 145596, 147981, 146440, 148497, 151395, 145689, 146067, 148734, 147343, 151414, 145065, 147142, 147123, 146693, 146700, 146382, 148395, 145315, 151402, 145352, 147735, 146305, 149941, 141390, 146911, 146558, 147926, 146863, 146357, 147624, 151380, 145612, 146416, 149194, 146982, 147315, 148710, 149452, 148035, 148398, 145126, 148716, 149212, 146027, 149211, 148402, 144628, 144876, 147931, 146612, 148114, 148735, 146203, 147124, 146556, 151398, 147061, 148722, 144904, 149051, 148707, 146607, 146020, 146375, 148714, 145803, 148192, 144867, 147057, 148386, 148540, 74251, 147599, 145868, 146785, 146349, 147574, 148718, 146387, 145740, 144912, 145187, 149948, 146374, 151407, 146401, 149996, 146470, 145013, 147647, 149955, 145289, 148188, 145742, 146608, 145701, 144736, 149396, 146264, 146132, 147771, 145233, 146912, 146978, 146981, 146560, 145200, 145461, 145048, 147613, 146710, 146554, 146337, 147615, 147184, 145429, 146471, 31890, 147238, 146336, 147463, 148206, 147477, 150040, 151388, 148118, 146147, 148706, 146253, 146358, 147568, 146045, 145282, 144236, 146326, 145354, 145453, 146435, 149923, 149958, 147732, 144582, 149207, 146392, 147263, 146517, 146135, 146697, 145664, 147825, 145236, 144321, 145931, 148730, 146708, 145869, 145475, 149954, 145285, 148811, 147269, 146931, 148737, 151390, 148106, 145022, 151389, 146930, 146606, 148214, 146108, 148179, 144916, 150085, 145299, 145598, 151410, 148513, 148271, 149185, 149208, 148324, 147062, 148117, 148430, 147472, 146204, 148539, 147440, 146516, 146555, 148803, 145088, 147256, 144875, 147408, 145445, 147643, 148708, 148815, 147335, 146768, 147932, 146767, 144503, 149192, 145953, 148147, 145957, 149926, 145558, 147961, 149960, 147572, 148239, 149928, 148406, 149936, 145988, 147690, 148108, 148892, 147840, 144600, 145133, 148938, 145733, 144741, 149215, 147917, 147512, 145104, 144538, 145739, 148163, 147234, 148940, 144822, 145610, 146384, 147183, 146765, 146868, 145335, 146543, 145751, 147311, 148407, 147275, 146268, 145081, 147384, 151416, 146099, 147796, 146302, 147209, 148739, 148866, 147967, 146695, 147125, 146422, 147169, 146414, 148937, 147623, 146663, 144654, 144816, 149214]:
        logits[i] = float("-inf")

    return logits
